

ต่อไปนี้เป็นการอธิบาย**สมการ**และ**ตัวแปรที่ใช้**ในสองวิธีที่โปรแกรมนี้ใช้ในการมอบหมายกิจกรรมให้พนักงาน ได้แก่ **Linear Programming** (ใช้ในฟังก์ชัน `assign_single_activity_from_df`) และ **Greedy Algorithm** (ใช้ในฟังก์ชัน `use_greedy_algorithm`) โดยจะแยกอธิบายสำหรับแต่ละวิธีอย่างชัดเจน

---

### **1. Linear Programming (ใช้ PuLP)**

#### **ตัวแปร**

- **ตัวแปรตัดสินใจ (Decision Variables)**:

  - $ x\_{i,j} $: ตัวแปรไบนารี (0 หรือ 1) ที่ระบุว่าพนักงาน $ i $ (EMPLOYEE_ID) ได้รับมอบหมายให้ทำกิจกรรม $ j $ (Activity) หรือไม่
    - $ x\_{i,j} = 1 $: พนักงาน $ i $ ได้รับมอบหมายกิจกรรม $ j $
    - $ x\_{i,j} = 0 $: พนักงาน $ i $ ไม่ได้รับมอบหมายกิจกรรม $ j $
  - $ i \in E $: $ E $ คือเซตของพนักงานทั้งหมดในส่วนงาน ($ E = \{ \text{EMPLOYEE\_ID}\_1, \text{EMPLOYEE\_ID}\_2, \dots \} $)
  - $ j \in A $: $ A $ คือเซตของกิจกรรมทั้งหมดในส่วนงาน ($ A = \{ \text{Activity}\_1, \text{Activity}\_2, \dots \} $)

- **ตัวแปรข้อมูลนำเข้า (Input Parameters)**:

  - $ v\_{i,j} $: สัดส่วนการทำงานของพนักงาน $ i $ ในกิจกรรม $ j $ (จากคอลัมน์ `Values` ใน DataFrame, ค่าอยู่ในช่วง [0, 1])

  - $ r\_j $: สัดส่วนภาพรวมของส่วนงานสำหรับกิจกรรม $ j $ (คำนวณจาก $ r\_j = \frac{\sum\_{i \in E} v\_{i,j}}{\sum\_{j \in A} \sum\_{i \in E} v\_{i,j}} $)

  - $ w\_{\text{ind}} $: น้ำหนักของสัดส่วนงานของพนักงาน ($ \text{individual\_weight} $, ค่าเริ่มต้น 0.7)

  - $ w\_{\text{sec}} $: น้ำหนักของสัดส่วนภาพรวมของส่วนงาน ($ \text{section\_weight} $, ค่าเริ่มต้น 0.3)

  - $ t\_j $: เป้าหมายจำนวนพนักงานที่ควรได้รับมอบหมายในกิจกรรม $ j $ (คำนวณจาก $ t\_j = \text{round}(|E| \cdot r\_j) $, โดย $ |E| $ คือจำนวนพนักงานทั้งหมด)

  - $ s\_{i,j} $: คะแนนสำหรับการมอบหมายพนักงาน $ i $ ให้ทำกิจกรรม $ j $

    - คำนวณจาก:
      $$
      s\_{i,j} = (v\_{i,j} \cdot w\_{\text{ind}}) + (r\_j \cdot w\_{\text{sec}})
      $$

  - $ S\_i $: เซตของพนักงานที่มีเงื่อนไขพิเศษ (พนักงานที่ทำกิจกรรม $ j $ เดียวด้วยสัดส่วน 100%, คือ $ v\_{i,j} = 1.0 $) พร้อมกิจกรรมที่ต้องมอบหมายให้ ($ j $)

#### **สมการ**

1. **ฟังก์ชันวัตถุประสงค์ (Objective Function)**:

   - เป้าหมายคือ**เพิ่มคะแนนรวมของการมอบหมายให้สูงสุด**:
     $$
     \text{Maximize} \quad \sum\_{i \in E} \sum\_{j \in A} s\_{i,j} \cdot x\_{i,j}
     $$

   - อธิบาย: ต้องการให้การมอบหมายมีคะแนนรวมสูงสุด โดยคะแนน $ s\_{i,j} $ คำนวณจากความเหมาะสมของพนักงานในกิจกรรมนั้น (จากสัดส่วนส่วนตัวและภาพรวมของส่วนงาน)

2. **ข้อจำกัด (Constraints)**:

   - **พนักงานแต่ละคนต้องได้รับมอบหมายเพียง 1 กิจกรรม**:
     $$
     \sum\_{j \in A} x\_{i,j} = 1 \quad \forall i \in E
     $$

     - อธิบาย: ทุกพนักงานต้องได้รับมอบหมายกิจกรรมหนึ่งและเพียงหนึ่งกิจกรรมเท่านั้น

   - **จำนวนพนักงานที่ได้รับมอบหมายในแต่ละกิจกรรมต้องเท่ากับเป้าหมาย**:
     $$
     \sum\_{i \in E} x\_{i,j} = t\_j \quad \forall j \in A \text{ where } t\_j > 0
     $$

     - อธิบาย: จำนวนพนักงานที่ได้รับมอบหมายในกิจกรรม $ j $ ต้องตรงกับเป้าหมาย $ t\_j $ (เฉพาะกิจกรรมที่มีเป้าหมายมากกว่า 0)

   - **เงื่อนไขพิเศษสำหรับพนักงานที่ทำกิจกรรมเดียว 100%**:
     $$
     x\_{i,j} = 1 \quad \forall (i, j) \in S\_i
     $$

     - อธิบาย: พนักงานที่มีเงื่อนไขพิเศษ (ทำกิจกรรม $ j $ ด้วยสัดส่วน 100%) ต้องได้รับมอบหมายกิจกรรม $ j $ นั้น

   - **ตัวแปรเป็นไบนารี**:
     $$
     x\_{i,j} \in \{0, 1\} \quad \forall i \in E, j \in A
     $$

     - อธิบาย: $ x\_{i,j} $ ต้องเป็น 0 หรือ 1 เท่านั้น

3. **การปรับเป้าหมาย (ถ้าจำเป็น)**:

   - หากผลรวมของ $ t\_j $ ไม่เท่ากับจำนวนพนักงานทั้งหมด ($ \sum\_{j \in A} t\_j \neq |E| $) จะมีการปรับ $ t\_j $:

     - ถ้า $ \sum\_{j \in A} t\_j < |E| $: เพิ่ม $ t\_j $ ของกิจกรรมที่มี $ r\_j $ สูงสุด
     - ถ้า $ \sum\_{j \in A} t\_j > |E| $: ลด $ t\_j $ ของกิจกรรมที่มี $ r\_j $ ต่ำสุด

   - สูตรการปรับ:
     $$
     \text{Difference} = |E| - \sum\_{j \in A} t\_j
     $$

     - ถ้า $\text{Difference} > 0$: $ t\_{j\_{\text{max}}} += \text{Difference} $
     - ถ้า $\text{Difference} < 0$: ลด $ t\_j $ จาก $ j $ ที่มี $ r\_j $ ต่ำสุดจนครบ $\text{Difference}$

---

### **2. Greedy Algorithm**

#### **ตัวแปร**

- **ตัวแปรข้อมูลนำเข้า (Input Parameters)**:

  - ตัวแปรส่วนใหญ่เหมือนกับ Linear Programming:

    - $ v\_{i,j} $: สัดส่วนการทำงานของพนักงาน $ i $ ในกิจกรรม $ j $

    - $ r\_j $: สัดส่วนภาพรวมของส่วนงานสำหรับกิจกรรม $ j $

    - $ w\_{\text{ind}} $: น้ำหนักของสัดส่วนงานของพนักงาน (0.7)

    - $ w\_{\text{sec}} $: น้ำหนักของสัดส่วนภาพรวมของส่วนงาน (0.3)

    - $ t\_j $: เป้าหมายจำนวนพนักงานในกิจกรรม $ j $

    - $ s\_{i,j} $: คะแนนสำหรับการมอบหมายพนักงาน $ i $ ให้ทำกิจกรรม $ j $
      $$
      s\_{i,j} = (v\_{i,j} \cdot w\_{\text{ind}}) + (r\_j \cdot w\_{\text{sec}})
      $$

    - $ S\_i $: เซตของพนักงานที่มีเงื่อนไขพิเศษและกิจกรรมที่ต้องมอบหมาย

  - ตัวแปรเพิ่มเติม:

    - $ AE $: เซตของพนักงานที่ได้รับมอบหมายแล้ว ($ AE \subseteq E $)
    - $ AA\_j $: จำนวนพนักงานที่ได้รับมอบหมายในกิจกรรม $ j $ (เริ่มต้นเป็น 0)
    - $ Assignments $: Dictionary ที่เก็บผลการมอบหมาย ($ \text{Assignments}[i] = j $ หมายถึงพนักงาน $ i $ ได้รับมอบหมายกิจกรรม $ j $)

- **ตัวแปรชั่วคราว**:

  - $ Q $: Priority Queue (หรือรายการที่เรียงลำดับ) ที่เก็บการมอบหมายที่เป็นไปได้ทั้งหมดในรูปแบบ:
    - $ \{ \text{emp\_id}: i, \text{activity}: j, \text{score}: s\_{i,j} \} $
    - เรียงตาม $ s\_{i,j} $ จากมากไปน้อย

#### **สมการ**

1. **การคำนวณคะแนน**:

   - คะแนนสำหรับการมอบหมายพนักงาน $ i $ ให้ทำกิจกรรม $ j $:
     $$
     s\_{i,j} = (v\_{i,j} \cdot w\_{\text{ind}}) + (r\_j \cdot w\_{\text{sec}})
     $$

   - อธิบาย: คะแนนนี้ใช้ในการตัดสินใจเลือกการมอบหมายที่ดีที่สุด

2. **การกำหนดเป้าหมายจำนวนพนักงาน**:

   - จำนวนพนักงานเป้าหมายสำหรับกิจกรรม $ j $:
     $$
     t\_j = \text{round}(|E| \cdot r\_j)
     $$

   - อธิบาย: คำนวณจากสัดส่วนภาพรวมของส่วนงาน คล้ายกับ Linear Programming

3. **ขั้นตอนการมอบหมาย (Algorithmic Steps, ไม่ใช่สมการโดยตรง)**:

   - **ขั้นตอน 1: มอบหมายพนักงานที่มีเงื่อนไขพิเศษ**:
     $$
     \text{If } (i, j) \in S\_i \text{ then } \text{Assignments}[i] = j, \quad AE = AE \cup \{i\}, \quad AA\_j += 1
     $$

   - **ขั้นตอน 2: สร้าง Priority Queue**:
     $$
     Q = [ \{ \text{emp\_id}: i, \text{activity}: j, \text{score}: s\_{i,j} \} \quad \forall i \in E \setminus AE, j \in A ]
     $$

     - เรียง $ Q $ ตาม $ s\_{i,j} $ จากมากไปน้อย

   - **ขั้นตอน 3: มอบหมายพนักงานที่เหลือตามคะแนน**:
     $$
     \text{For each } q \in Q:
     $$

     $$
     \text{If } q.\text{emp\_id} \notin AE \text{ and } AA\_{q.\text{activity}} < t\_{q.\text{activity}}:
     $$

     $$
     \text{Assignments}[q.\text{emp\_id}] = q.\text{activity}, \quad AE = AE \cup \{q.\text{emp\_id}\}, \quad AA\_{q.\text{activity}} += 1
     $$

   - **ขั้นตอน 4: มอบหมายพนักงานที่ยังไม่ได้รับมอบหมาย**:
     $$
     \text{For each } i \in E \setminus AE:
     $$

     $$
     j^* = \arg\max\_{j \in A} s\_{i,j}
     $$

     $$
     \text{Assignments}[i] = j^*, \quad AE = AE \cup \{i\}, \quad AA\_{j^*} += 1
     $$

4. **การสร้างผลลัพธ์**:

   - สำหรับแต่ละการมอบหมาย $ \text{Assignments}[i] = j $:

     - คำนวณข้อมูลผลลัพธ์:
       $$
       \text{Result} = \{ \text{EMPLOYEE\_ID}: i, \text{NAME}, \text{ASSIGNED\_ACTIVITY}: j, \text{ORIGINAL\_VALUE}: v\_{i,j}, \text{SCORE}: s\_{i,j} \}
       $$

   - สรุปจำนวนพนักงานในแต่ละกิจกรรม:
     $$
     \text{ASSIGNED\_COUNT}\_j = AA\_j
     $$

     $$
     \text{MATCHING}\_j = (\text{ASSIGNED\_COUNT}\_j == t\_j)
     $$

---

### **เปรียบเทียบสมการและตัวแปร**

| **ด้าน**         | **Linear Programming**                                       | **Greedy Algorithm**                                         |
| --------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **ตัวแปรตัดสินใจ** | $ x\_{i,j} $ (ไบนารี)                                         | ไม่มีตัวแปรตัดสินใจแบบชัดเจน ใช้ $ \text{Assignments} $ เพื่อเก็บผลการมอบหมาย |
| **คะแนน**       | $ s\_{i,j} = (v\_{i,j} \cdot w\_{\text{ind}}) + (r\_j \cdot w\_{\text{sec}}) $ | เหมือนกัน                                                      |
| **เป้าหมาย**     | Maximize $ \sum\_{i \in E} \sum\_{j \in A} s\_{i,j} \cdot x\_{i,j} $ | เลือกการมอบหมายที่มี $ s\_{i,j} $ สูงสุดตามลำดับ                    |
| **ข้อจำกัด**      | - พนักงาน 1 คนต่อ 1 กิจกรรม<br>- จำนวนพนักงานในกิจกรรม = $ t\_j $<br>- เงื่อนไขพิเศษ | - พิจารณาเงื่อนไขพิเศษก่อน<br>- จำกัด $ AA\_j \leq t\_j $<br>- มอบหมายทุกพนักงาน |
| **วิธีการแก้ปัญหา** | ใช้ PuLP เพื่อหาคำตอบที่เหมาะสมที่สุด                                | ใช้การเรียงลำดับคะแนนและเลือกตามลำดับ (Greedy)                    |
| **ผลลัพธ์**       | $ x\_{i,j} = 1 $ ระบุการมอบหมาย                               | $ \text{Assignments}[i] = j $ ระบุการมอบหมาย                  |

---

### **หมายเหตุ**

- **Linear Programming** เหมาะสำหรับการหาคำตอบที่เหมาะสมที่สุด (optimal) แต่ใช้เวลาและทรัพยากรการคำนวณมากกว่า และอาจล้มเหลวหากข้อจำกัดขัดแย้งกัน
- **Greedy Algorithm** เร็วกว่าและรับประกันว่าจะมอบหมายทุกพนักงาน แต่ผลลัพธ์อาจไม่เหมาะสมที่สุด (suboptimal)
- ทั้งสองวิธีใช้ **คะแนน $ s\_{i,j} $** และ **เป้าหมาย $ t\_j $** ที่คำนวณจากข้อมูลเดียวกัน เพื่อให้ผลลัพธ์สอดคล้องกับความต้องการของส่วนงาน

Ref. https://grok.com/share/bGVnYWN5_92ee1668-a129-4951-bdc1-d2fc92f21fb0

